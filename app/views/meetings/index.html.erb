<h2>Meeting List</h2>

<% @districts.each do |district| %>
<table class="meeting_list" cellpadding="0" cellspacing="0">
  <thead>
    <tr>
      <th class="district"><h3><%= district.name %></h3></th>
      <% Date::DAYNAMES.each do |day| %>
        <th><%= day[0..2].upcase %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
  <% district.meeting_addresses.each do |meeting_address| %>
    <tr>
      <td class="building"><%= meeting_address.building %><br><div class="note"><%= meeting_address.street1 %> <%= meeting_address.street2 %></div></td>
      <% 7.times do |wday| %>
        <td class="time">
          <% meeting_address.meetings.each do |meeting| %>
            <% if wday == meeting.wday %>
              <%= link_to meeting.time, meeting_path(meeting) %>
              <% unless meeting.topic.blank? %>
                <br><span class="note">(<%= raw meeting.topic %>)</span>
              <% end %>
            <% end %>
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
  </tbody>
</table>
<% end %>

<div id="google_map" class="meeting_list_map" style="width: 650px; height: 500px;"></div>
<script type="text/javascript" charset="utf-8">
var _meeting_addresses = <%= raw @map_meeting_addresses.to_json -%>;

function showMeetingsMap() {
  var locations = _meeting_addresses;
  var latlng = new google.maps.LatLng(0, 0);
  var bounds = new google.maps.LatLngBounds();
  var myOptions = {
    panControl: false,
    streetViewControl: false,
    mapTypeControlOptions: { style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  var map = new google.maps.Map(document.getElementById("google_map"), myOptions);
  
  for (var i = 0; i < locations.length; i++) {
    var location = locations[i];
    var markerLatLng = new google.maps.LatLng(location[1], location[2]);
    var marker = new google.maps.Marker({
      map: map,
      position: markerLatLng,
      title: location[0].replace(/'|"/gi,"")
    });
    bounds.extend(markerLatLng);
    map.fitBounds(bounds);
  }
}

loadGoogleMap(0, 0, 'showMeetingsMap');
</script>